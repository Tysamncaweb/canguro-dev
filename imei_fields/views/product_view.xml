<?xml version="1.0" encoding="utf-8"?>
<odoo>

    <!-- view used for product.template only -->
    <record id="imei_product_template" model="ir.ui.view">
        <field name="name">lot.series.imei.button</field>
        <field name="model">product.template</field>
        <field name="inherit_id" ref="stock.product_template_form_view_procurement_button"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_open_product_lot']" position="replace">
                <button 
                    string="Lot/Serial Number/IMEI" type="object"
                    name="action_open_product_lot"
                    attrs="{'invisible': [('tracking', '=', 'none')]}"
                    class="oe_stat_button"
                    icon="fa-bars"
                    groups="stock.group_production_lot"
                />
            </xpath>
        </field>
    </record>
    
    <!-- view used for product.product only -->
    <record id="imei_product_product" model="ir.ui.view">
        <field name="name">lot.series.imei.variant.button</field>
        <field name="model">product.product</field>
        <field name="inherit_id" ref="stock.product_form_view_procurement_button"/>
        <field name="arch" type="xml">
            <xpath expr="//button[@name='action_open_product_lot']" position="replace">
                <button 
                    string="Lot/Serial Number/IMEI" type="object"
                    name="action_open_product_lot"
                    attrs="{'invisible': [('tracking', '=', 'none')]}"
                    class="oe_stat_button"
                    icon="fa-bars"
                    groups="stock.group_production_lot"
                />
            </xpath>
        </field>
    </record>


<!-- We change the menu for Lots/Serial Numbers -->
    <record id="stock.action_production_lot_form" model="ir.actions.act_window">
        <field name="name">Lotes/Números de serie/IMEI</field>
        <field name="type">ir.actions.act_window</field>
        <field name="res_model">stock.production.lot</field>
        <field name="view_ids"
                   eval="[(5, 0, 0),
                          (0, 0, {'view_mode': 'tree', 'view_id': ref('stock.view_production_lot_tree')}),
                          (0, 0, {'view_mode': 'form', 'view_id': ref('stock.view_production_lot_form')})]"/>
        <field name="search_view_id" ref="stock.search_product_lot_filter"/>
        <field name="context">{'search_default_group_by_product': 1}</field>
        <field name="help" type="html">
          <p class="o_view_nocontent_smiling_face">
            Add a lot/serial number/IMEI
          </p><p>
            This is the list of all the production lots you recorded. When
            you select a lot, you can get the traceability of the products contained in lot.
          </p>
        </field>
    </record>

    <menuitem 
        action="stock.action_production_lot_form"
        name="Lotes/Números de serie/IMEI"
        id="stock.menu_action_production_lot_form"
        parent="stock.menu_stock_inventory_control" 
        groups="stock.group_production_lot"
        sequence="101"/>

</odoo>